import{C as k}from"./chunk-AYEDX2M7.js";import{A as n,M as h,N as p,O as a,R as m,W as g,i as u,j as i,m as l,n as s,y as c}from"./chunk-ZGXC4ISU.js";var b=class o{constructor(t){this.http=t;this.checkAuth().subscribe(e=>{e&&this.startTokenRefreshTimer()})}baseUrl="/api";_isLoggedIn=new i(this.hasAccessToken());isLoggedIn$=this._isLoggedIn.asObservable();_userEmailSubject=new i(this.getUserEmail());userEmail$=this._userEmailSubject.asObservable();stopTokenRefresh$=new u;tokenRefreshTimer;REFRESH_INTERVAL=20*60*1e3;login(t){return this.http.post(`${this.baseUrl}/login`,t).pipe(a({next:e=>{console.log("P\u0159ihl\xE1\u0161en\xED \xFAsp\u011B\u0161n\xE9:",e),console.log(e.user.user_login_id),localStorage.setItem("accessToken",e.token),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("userEmail",e.user.user_email),localStorage.setItem("userId",e.user.user_login_id),this._userEmailSubject.next(e.user.user_email),e.user_roles&&e.user_roles.length>0?localStorage.setItem("userRole",e.user_roles[0]):localStorage.removeItem("userRole"),this._isLoggedIn.next(!0),this.startTokenRefreshTimer()},error:e=>{console.error("Chyba p\u0159ihl\xE1\u0161en\xED:",e),this.clearAuthData()}}),n(e=>{let r="Neplatn\xE9 u\u017Eivatelsk\xE9 jm\xE9no nebo heslo.";return e.status===401&&e.error&&e.error.message?r=e.error.message:e.status!==401&&(r="Vyskytla se chyba p\u0159i komunikaci se serverem."),s(()=>new Error(r))}))}logout(){let t=this.getRefreshToken(),e=t?{refreshToken:t}:{};return this.http.post(`${this.baseUrl}/logout`,e).pipe(a({next:()=>{console.log("Odhl\xE1\u0161en\xED \xFAsp\u011B\u0161n\xE9."),this.clearAuthData(),this.stopTokenRefreshTimer()},error:r=>{console.error("Chyba p\u0159i odhl\xE1\u0161en\xED:",r),this.clearAuthData(),this.stopTokenRefreshTimer()}}),n(()=>s(()=>new Error("Chyba p\u0159i odhl\xE1\u0161en\xED."))))}refreshAccessToken(){let t=this.getRefreshToken();return t?this.http.post(`${this.baseUrl}/refresh`,{refreshToken:t}).pipe(a({next:e=>{console.log("P\u0159\xEDstupov\xFD token obnoven:",e),localStorage.setItem("accessToken",e.token),localStorage.setItem("refreshToken",e.refreshToken),this._isLoggedIn.next(!0),this.startTokenRefreshTimer()},error:e=>{console.error("Chyba p\u0159i obnovov\xE1n\xED tokenu:",e),this.clearAuthData(),this.stopTokenRefreshTimer()}}),n(e=>{let r="Nepoda\u0159ilo se obnovit token.";return e.status===401&&e.error&&e.error.message&&(r=e.error.message),s(()=>new Error(r))})):(console.warn("Refresh token nen\xED v Local Storage, nelze obnovit."),this.clearAuthData(),this.stopTokenRefreshTimer(),s(()=>new Error("Refresh token chyb\xED.")))}clearAuthData(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),localStorage.removeItem("userRole"),this._isLoggedIn.next(!1),this._userEmailSubject.next(null)}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}getUserId(){return localStorage.getItem("userId")}getUserEmail(){return localStorage.getItem("userEmail")}setUserEmail(t){localStorage.setItem("userEmail",t),this._userEmailSubject.next(t)}getUserRole(){return localStorage.getItem("userRole")}hasAccessToken(){return!!localStorage.getItem("accessToken")}checkAuth(){return this.hasAccessToken()?l(!0):this.refreshAccessToken().pipe(n(()=>l(!1)))}startTokenRefreshTimer(){this.stopTokenRefreshTimer(),console.log("Spou\u0161t\xEDm proaktivn\xED \u010Dasova\u010D pro obnovu tokenu."),this.tokenRefreshTimer=c(this.REFRESH_INTERVAL).pipe(h(()=>this.refreshAccessToken()),p(this.stopTokenRefresh$)).subscribe()}stopTokenRefreshTimer(){console.log("Zastavuji proaktivn\xED \u010Dasova\u010D pro obnovu tokenu."),this.stopTokenRefresh$.next()}static \u0275fac=function(e){return new(e||o)(g(k))};static \u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"})};function f(o){let t=o,e=Math.floor(Math.abs(o)),r=o.toString().replace(/^[^.]*\.?/,"").length;return e===1&&r===0?1:e===Math.floor(e)&&e>=2&&e<=4&&r===0?3:r!==0?4:5}var y=["cs",[["dop.","odp."],void 0,void 0],void 0,[["N","P","\xDA","S","\u010C","P","S"],["ne","po","\xFAt","st","\u010Dt","p\xE1","so"],["ned\u011Ble","pond\u011Bl\xED","\xFAter\xFD","st\u0159eda","\u010Dtvrtek","p\xE1tek","sobota"],["ne","po","\xFAt","st","\u010Dt","p\xE1","so"]],void 0,[["1","2","3","4","5","6","7","8","9","10","11","12"],["led","\xFAno","b\u0159e","dub","kv\u011B","\u010Dvn","\u010Dvc","srp","z\xE1\u0159","\u0159\xEDj","lis","pro"],["ledna","\xFAnora","b\u0159ezna","dubna","kv\u011Btna","\u010Dervna","\u010Dervence","srpna","z\xE1\u0159\xED","\u0159\xEDjna","listopadu","prosince"]],[["1","2","3","4","5","6","7","8","9","10","11","12"],["led","\xFAno","b\u0159e","dub","kv\u011B","\u010Dvn","\u010Dvc","srp","z\xE1\u0159","\u0159\xEDj","lis","pro"],["leden","\xFAnor","b\u0159ezen","duben","kv\u011Bten","\u010Derven","\u010Dervenec","srpen","z\xE1\u0159\xED","\u0159\xEDjen","listopad","prosinec"]],[["p\u0159.n.l.","n.l."],["p\u0159. n. l.","n. l."],["p\u0159ed na\u0161\xEDm letopo\u010Dtem","na\u0161eho letopo\u010Dtu"]],1,[6,0],["dd.MM.yy","d. M. y","d. MMMM y","EEEE d. MMMM y"],["H:mm","H:mm:ss","H:mm:ss z","H:mm:ss zzzz"],["{1} {0}",void 0,void 0,void 0],[",","\xA0",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0\xA0%","#,##0.00\xA0\xA4","#E0"],"CZK","K\u010D","\u010Desk\xE1 koruna",{AUD:["AU$","$"],BYN:[void 0,"\u0440."],CSK:["K\u010Ds"],CZK:["K\u010D"],ILS:[void 0,"\u20AA"],INR:[void 0,"\u20B9"],JPY:["JP\xA5","\xA5"],PHP:[void 0,"\u20B1"],RON:[void 0,"L"],RUR:[void 0,"\u0440."],TWD:["NT$"],USD:["US$","$"],VND:[void 0,"\u20AB"],XEU:["ECU"],XXX:[]},"ltr",f];export{b as a,y as b};
