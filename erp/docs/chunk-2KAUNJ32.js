import{C as p}from"./chunk-BPBWVEAM.js";import{K as n,N as c,S as h,i,l,m as o,x as s}from"./chunk-KQIGX7DT.js";var g=class a{constructor(t){this.http=t;this.checkAuth().subscribe()}baseUrl="/api";_isLoggedIn=new i(this.hasAccessToken());isLoggedIn$=this._isLoggedIn.asObservable();login(t){return this.http.post(`${this.baseUrl}/login`,t).pipe(n({next:e=>{console.log("P\u0159ihl\xE1\u0161en\xED \xFAsp\u011B\u0161n\xE9:",e),localStorage.setItem("accessToken",e.token),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("userEmail",e.user.user_email),this._isLoggedIn.next(!0)},error:e=>{console.error("Chyba p\u0159ihl\xE1\u0161en\xED:",e),this.clearAuthData()}}),s(e=>{let r="Neplatn\xE9 u\u017Eivatelsk\xE9 jm\xE9no nebo heslo.";return e.status===401&&e.error&&e.error.message?r=e.error.message:e.status!==401&&(r="Vyskytla se chyba p\u0159i komunikaci se serverem."),o(()=>new Error(r))}))}logout(){let t=this.getRefreshToken(),e=t?{refreshToken:t}:{};return this.http.post(`${this.baseUrl}/logout`,e).pipe(n({next:()=>{console.log("Odhl\xE1\u0161en\xED \xFAsp\u011B\u0161n\xE9."),this.clearAuthData()},error:r=>{console.error("Chyba p\u0159i odhl\xE1\u0161en\xED:",r),this.clearAuthData()}}),s(()=>o(()=>new Error("Chyba p\u0159i odhl\xE1\u0161en\xED."))))}refreshAccessToken(){let t=this.getRefreshToken();return t?this.http.post(`${this.baseUrl}/refresh`,{refreshToken:t}).pipe(n({next:e=>{console.log("P\u0159\xEDstupov\xFD token obnoven:",e),localStorage.setItem("accessToken",e.token),localStorage.setItem("refreshToken",e.refreshToken),this._isLoggedIn.next(!0)},error:e=>{console.error("Chyba p\u0159i obnovov\xE1n\xED tokenu:",e),this.clearAuthData()}}),s(e=>{let r="Nepoda\u0159ilo se obnovit token.";return e.status===401&&e.error&&e.error.message&&(r=e.error.message),o(()=>new Error(r))})):(console.warn("Refresh token nen\xED v Local Storage, nelze obnovit."),this.clearAuthData(),o(()=>new Error("Refresh token chyb\xED.")))}clearAuthData(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("userEmail"),this._isLoggedIn.next(!1)}getAccessToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}getUserEmail(){return localStorage.getItem("userEmail")}hasAccessToken(){return!!localStorage.getItem("accessToken")}checkAuth(){return this.hasAccessToken()?l(!0):this.refreshAccessToken().pipe(s(()=>l(!1)))}static \u0275fac=function(e){return new(e||a)(h(p))};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
