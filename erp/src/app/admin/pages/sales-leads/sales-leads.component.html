<div class="user-request-container container mx-auto p-4">
  <div *ngIf="isLoading" class="text-center text-blue-500">Načítání dat...</div>
  <div *ngIf="isLoading" class="text-center text-blue-500">
    <button class="neutral_button" style="margin-top: 15px;" (click)="refreshData()">
      Znovu načíst data
    </button>
  </div>
  
  <div *ngIf="errorMessage" class="text-center text-red-500">{{ errorMessage }}</div>
  
  <div *ngIf="!isLoading && !errorMessage">
    <div class="main-content-layout">

      <app-generic-filter-form
        [filterColumns]="filterColumns"
        [initialFilters]="{ 
          search: filterSearch, 
          status: filterStatus, 
          priority: filterPriority, 
          subject_name: filterSubjectName,
          salesman_name: filterSalesmanName,
          location: filterLocation,
          id: filterId,
          created_at: filterCreatedAt,
          updated_at: filterUpdatedAt
        }"
        [initialSortBy]="filterSortBy"
        [initialSortDirection]="filterSortDirection"
        (filtersApplied)="applyFilters($event)"
        (filtersCleared)="clearFilters()">
      </app-generic-filter-form>
      
      <div class="table-and-pagination-container">

        <app-generic-table *ngIf="!showTrashTable"
          [buttons]="buttons"
          [data]="data"
          [columns]="salesLeadColumns"
          [tableCaption]="'Seznam obchodních leadů'"
          [isLoading]="isLoading"
          [apiEndpoint]="apiEndpoint"
          (itemDeleted)="handleItemDeleted()"
          (createFormOpened)="handleCreateFormOpened()"
          (editFormOpened)="handleEditFormOpened($event)"
          (viewDetailsOpened)="handleViewDetails($event)">
        </app-generic-table>

        <app-generic-trash-table *ngIf="showTrashTable"
          [data]="trashData"
          [columns]="trashSalesLeadColumns"
          [tableCaption]="'Obnova smazaných leadů'"
          [isLoading]="isLoading"
          [apiEndpoint]="apiEndpoint"
          (itemRestored)="handleItemRestored()">
        </app-generic-trash-table>

        <button *appHasPermission="'view-deleted'" (click)="toggleTable()" class="toggle-table-btn neutral_button m-b-10">
          {{ showTrashTable ? 'Zobrazit Aktivní Leady' : 'Zobrazit Smazané Leady' }}
        </button>
        
        <div class="pagination-controls-wrapper" *ngIf="!showTrashTable">
          <div class="text-sm text-gray-700 p-b-10">
            Zobrazuji {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ (currentPage - 1) * itemsPerPage + data.length }} z celkem {{ totalItems }} leadů.
          </div>
          <div class="flex items-center space-x-2 pg-m p-b-10">
            <label for="itemsPerPage" class="text-sm text-gray-700">Položek na stránku:</label>
            <select id="itemsPerPage" (change)="onItemsPerPageChange($event)"
                    class="items-per-page-select" [(ngModel)]="itemsPerPage">
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="15">15</option>
              <option value="50">50</option>
            </select>
          </div>
          <nav class="pagination-nav">
            <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1" class="pagination-button">Zpět</button>
            <ng-container *ngFor="let page of pagesArray">
              <button (click)="goToPage(page)" [ngClass]="{ 'active-page': page === currentPage }" class="pagination-button">{{ page }}</button>
            </ng-container>
            <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages" class="pagination-button">Vpřed</button>
          </nav>
        </div>

        <div class="pagination-controls-wrapper" *ngIf="showTrashTable">
          <div class="text-sm text-gray-700 p-b-10">
            Zobrazuji {{ (trashCurrentPage - 1) * trashItemsPerPage + 1 }} - {{ (trashCurrentPage - 1) * trashItemsPerPage + trashData.length }} z celkem {{ trashTotalItems }} smazaných záznamů.
          </div>
          <nav class="pagination-nav">
             <button (click)="goToTrashPage(trashCurrentPage - 1)" [disabled]="trashCurrentPage === 1" class="pagination-button">Zpět</button>
             <ng-container *ngFor="let page of trashPagesArray">
               <button (click)="goToTrashPage(page)" [ngClass]="{ 'active-page': page === trashCurrentPage }" class="pagination-button">{{ page }}</button>
             </ng-container>
             <button (click)="goToTrashPage(trashCurrentPage + 1)" [disabled]="trashCurrentPage === trashTotalPages" class="pagination-button">Vpřed</button>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<app-generic-form 
  *ngIf="showCreateForm" 
  [inputDefinitions]="formFields" 
  [formDataToEdit]="selectedItemForEdit"
  (formSubmitted)="handleFormSubmitted($event)"
  (formCanceled)="onCancelForm()">
</app-generic-form>

<app-generic-details 
  *ngIf="showDetails" 
  [itemDetailColumns]="detailsColumns"
  [itemData]="selectedItemForDetails"
  (closeDetails)="handleCloseDetails()">
</app-generic-details>