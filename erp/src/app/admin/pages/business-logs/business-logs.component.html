<div class="user-request-container container mx-auto p-4">
  <div *ngIf="isLoading" class="text-center text-blue-500">Načítání dat...</div>
  <div *ngIf="isLoading" class="text-center text-blue-500">
    <button class="neutral_button" style="margin-top: 15px;" (click)="refreshData()">
      Znovu načíst data
    </button>
  </div>
  
  <div *ngIf="errorMessage" class="text-center text-red-500">{{ errorMessage }}</div>
  <div *ngIf="errorMessage" class="text-center text-red-500">
    <button class="neutral_button" style="margin-top: 15px;" (click)="refreshData()">
      Znovu načíst data
    </button>
  </div>
  <div *ngIf="!isLoading && !errorMessage">
    <div class="main-content-layout">

      <app-generic-filter-form
        [filterColumns]="filterColumns"
        [initialFilters]="{ 
          business_log_id: filterBusinessLogId,
          created_at: filterCreatedAt,
          origin: filterOrigin,
          event_type: filterEventType,
          module: filterModule,
          description: filterDescription,
          affected_entity_type: filterAffectedEntityType,
          affected_entity_id: filterAffectedEntityId,
          user_login_id: filterUserLoginId, 
          'user.user_email': filterUserEmail, 
          context_data: filterContextData
        }"
        [initialSortBy]="filterSortBy"
        [initialSortDirection]="filterSortDirection"
        (filtersApplied)="applyFilters($event)"
        (filtersCleared)="clearFilters()">
      </app-generic-filter-form>
      
      <div class="table-and-pagination-container">

        <app-generic-table
          [buttons]="buttons"
          [data]="data"
          [columns]="tableColumns"
          [tableCaption]="'Seznam událostí systému'"
          [isLoading]="isLoading"
          [apiEndpoint]="apiEndpoint"
          [uploadsBaseUrl]="'[https://your-upload-domain.com/uploads/](https://your-upload-domain.com/uploads/)'"
          [isLogsTable]="true"
          (itemDeleted)="handleItemDeleted()"
          (createFormOpened)="handleCreateFormOpened()"
          (editFormOpened)="handleEditFormOpened($event)"
          (viewDetailsOpened)="handleViewDetails($event)">
        </app-generic-table>

        <div class="pagination-controls-wrapper">
          <div class="text-sm text-gray-700 p-b-10">
            Zobrazuji {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ (currentPage - 1) * itemsPerPage + data.length }} z celkem {{ totalItems }} záznamů.
          </div>
          <div class="flex items-center space-x-2 pg-m p-b-10">
            <label for="itemsPerPage" class="text-sm text-gray-700">Položek na stránku:</label>
            <select id="itemsPerPage" (change)="onItemsPerPageChange($event)"
                    class="items-per-page-select" [(ngModel)]="itemsPerPage">
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="15">15</option>
              <option value="20">20</option>
              <option value="50">50</option>
            </select>
          </div>
          <nav class="pagination-nav" aria-label="Pagination">
            <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1"
                    class="pagination-button first-page-btn">
              <span class="sr-only">Předchozí</span>
              <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
            <ng-container *ngFor="let page of pagesArray">
              <button (click)="goToPage(page)"
                      [ngClass]="{ 'active-page': page === currentPage }"
                      class="pagination-button">
                {{ page }}
              </button>
            </ng-container>
            <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages"
                    class="pagination-button last-page-btn">
              <span class="sr-only">Další</span>
              <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </nav>
        </div>

      </div>
    </div>
  </div>
</div>

<app-generic-details 
  *ngIf="showDetails" 
  [itemDetailColumns]="detailsColumns"
  [itemData]="selectedItemForDetails"
  (closeDetails)="handleCloseDetails()">
</app-generic-details>